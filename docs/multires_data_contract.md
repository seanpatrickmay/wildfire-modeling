# Multi-Resolution Data Contract (Manifest v2)

## Purpose
Define a versioned manifest that describes heterogeneous wildfire covariates (different spatial/temporal resolutions) while preserving backward compatibility with the current GOES/RTMA pipeline.

This contract is intended for:
- source selection and provenance,
- alignment/resampling policy,
- deterministic feature materialization.

## Backward Compatibility
- Existing manifests (`rtma_manifest.json`, GOES JSON metadata) remain valid for current scripts.
- Manifest v2 is additive and used by new multiresolution tooling.
- Existing regression scripts are unchanged until explicitly migrated.

## Top-Level Schema

```json
{
  "manifest_version": "2.0",
  "generated_at": "2026-02-09T22:00:00Z",
  "study_area": {
    "name": "North Complex",
    "bbox": [-121.58, 39.47, -120.70, 40.00],
    "bbox_crs": "EPSG:4326"
  },
  "time_window": {
    "start": "2020-08-17T16:00:00Z",
    "end": "2020-10-03T23:00:00Z",
    "model_time_step": "1h"
  },
  "target_grid": {
    "crs": "EPSG:3857",
    "resolution_m": 375.0,
    "alignment": "upper_left",
    "resampling_defaults": {
      "continuous": "bilinear",
      "categorical": "nearest"
    }
  },
  "sources": [],
  "variables": [],
  "provenance": {
    "config_path": "docs/examples/multires_config.example.json",
    "notes": "Generated by scripts/build_multires_manifest.py"
  }
}
```

## `sources[]` Object
Required fields:
- `id`: unique source identifier.
- `provider`: data provider.
- `dataset`: dataset name.
- `source_type`: `dynamic` or `static`.
- `native_resolution_m`: positive number.
- `native_temporal_resolution`: e.g. `hourly`, `daily`, `static`.
- `resampling_method`: e.g. `bilinear`, `nearest`, `average`, `max`.
- `source_priority`: integer priority for conflict resolution.
- `variables`: non-empty list.

Optional fields:
- `latency`: e.g. `historical`, `nrt`.
- `license`: short license note.
- `access`: object with `mode`, `url`, and optional auth notes.
- `coverage`: text (e.g., `CONUS`).

## `variables[]` (Flattened)
Each entry links to one source and provides normalized variable metadata:
- `source_id`
- `name`
- `dtype`
- `units`
- `kind` (`continuous` or `categorical`)

Optional:
- `null_value`
- `valid_range`

## Alignment Rules
1. All sources are projected/aligned to `target_grid` for model-ready tensors.
2. Continuous variables default to bilinear resampling unless overridden per source.
3. Categorical variables default to nearest-neighbor.
4. Time alignment uses nearest valid source timestep within configured tolerance.
5. Missingness is explicit; no silent fill of unavailable intervals.

## File Naming Guidance
Suggested outputs under fire folder:
- `multires_manifest_v2.json`
- `covariates_<source_id>_<grid_res>m_<start>_<end>.json` or `.npz`
- `coverage_report_<source_id>.json`

## Validation
Use:

```bash
python3 scripts/validate_multires_manifest.py --manifest path/to/multires_manifest_v2.json
```

Validation enforces:
- required keys and types,
- valid source types,
- positive target resolution,
- unique source IDs,
- non-empty variable lists.

## Related Files
- `scripts/build_multires_manifest.py`
- `scripts/validate_multires_manifest.py`
- `docs/examples/multires_config.example.json`
